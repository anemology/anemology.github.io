<!doctype html><html lang=zh-tw><head><meta charset=utf-8><title>使用 SSH Key 登入 Linux Server</title><meta name=description content><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://anemology.cc/index.xml title=翱翔在空中><meta name=twitter:card content="summary"><meta name=twitter:title content="使用 SSH Key 登入 Linux Server"><meta name=twitter:description content="最近因為在玩 P2P 的東西，所以需要一台 24/7 的電腦來跑。
剛好 GitHub Education 之前有送 DigitalOcean $50，就先拿來用了。"><link rel=stylesheet href=https://anemology.cc/fontawesome/css/all.min.css><link crossorigin=anonymous href=/css/styles.min.css integrity rel="preload stylesheet" as=style><link rel=stylesheet href=https://anemology.cc/css/custom.css><link id=dark-mode-theme crossorigin=anonymous href=/css/dark.min.css integrity rel="preload stylesheet" as=style><script>var darkTheme=document.getElementById("dark-mode-theme"),storedTheme=localStorage.getItem("dark-mode-storage");storedTheme==="dark"?darkTheme.disabled=!1:storedTheme==="light"&&(darkTheme.disabled=!0)</script><script defer crossorigin=anonymous src=/js/theme.js integrity></script>
<script defer crossorigin=anonymous src=/js/instantpage.min.js integrity></script><meta name=generator content="Hugo 0.98.0"></head><body><header><nav class=navbar><div class=nav><ul class=nav-links><li><a href=/tags id=Tags><em class="fas fa-tag fa-lg"></em></a></li><li><a href=/search id=Search><em class="fas fa-search fa-lg"></em></a></li><li><a href=/archives id=Archives><em class="fas fa-archive fa-lg"></em></a></li></ul></div></nav><div class=intro-header><div class=container><div class=post-heading><h1>使用 SSH Key 登入 Linux Server</h1><span class=meta-post><em class="fa fa-calendar-alt"></em>&nbsp;January 7, 2017
&nbsp;&nbsp;&nbsp;<em class="fa fa-folder-open"></em>&nbsp;
<a href=https://anemology.cc/categories/linux/>Linux</a>&nbsp;</span></div></div></div></header><div class=container role=main><article class=article class=blog-post><p>最近因為在玩 P2P 的東西，所以需要一台 24/7 的電腦來跑。</p><p>剛好 GitHub Education 之前有送 DigitalOcean $50，就先拿來用了。</p><p>怎麼在 DigitalOcean 建立 Droplet 就不說了，新建立好像可以直接匯入 SSH Key，就不用手動加 SSH Key。</p><p>OS: Ubuntu 16.04.1 x64</p><ol><li><p>root 連到 Linux Server，建立一個新的使用者。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>add user whatever
</span></span></code></pre></div></li><li><p>將使用者加入 sudo 群組。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gpasswd -a whatever sudo
</span></span></code></pre></div></li><li><p>使用 <a href=http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html>PuTTYgen</a> 建立公私鑰，也可以在 Linux 上用 <code>ssh-keygen</code> 指令建立。</p><p><img src=/img/ssh-key-login-linux-1.png alt=ssh-key-login-linux-1></p></li><li><p>登入剛剛建立的新使用者，在家目錄建立 <code>.ssh</code> 目錄。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>su - whatever
</span></span><span style=display:flex><span>mkdir .ssh
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>700</span> .ssh
</span></span></code></pre></div></li><li><p>新增 <code>authorized_keys</code> 檔案，並將公鑰內容貼進去，<code>Ctrl+X</code> 存檔。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano .ssh/authorized_keys
</span></span><span style=display:flex><span>chmod <span style=color:#ae81ff>600</span> .ssh/authorized_keys
</span></span></code></pre></div></li><li><p>輸入 <code>exit</code> 切換回 <code>root</code>，修改這個檔案。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano /etc/ssh/sshd_config
</span></span></code></pre></div></li><li><p>拿掉這幾行前面的註解 <code>#</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>RSAAuthentication yes
</span></span><span style=display:flex><span>PubkeyAuthentication yes
</span></span><span style=display:flex><span>AuthorizedKeysFile %h/.ssh/authorized_keys
</span></span></code></pre></div></li><li><p>將 <code>PasswordAuthentication</code> 設置為 <code>no</code>，就不能用密碼登入嚕。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>PasswordAuthentication no
</span></span></code></pre></div></li><li><p><code>Ctrl+X</code> 存檔後，重啟服務。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>service ssh restart
</span></span></code></pre></div></li><li><p>接著就可以在 PuTTY，用剛剛存下來的私鑰做驗證登入了 (不用密碼)。</p><p><img src=/img/ssh-key-login-linux-2.png alt=ssh-key-login-linux-2></p><p><img src=/img/ssh-key-login-linux-3.png alt=img/ssh-key-login-linux-3></p></li></ol><p> </p><p>因為公鑰是存放在 whatever 的家目錄，所以只能用 whatever 登入。</p><p>要用 root 登入的話就要在 /root 做同樣的事情，或是調整 <code>sshd_config</code> 的設定，不建議啦。</p><hr><p>參考資料：</p><p><a href=https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-14-04>Initial Server Setup with Ubuntu 14.04</a></p><div class=blog-tags><a href=https://anemology.cc/tags/linux/>linux</a>&nbsp;
<a href=https://anemology.cc/tags/ssh/>ssh</a>&nbsp;</div><ul class=bottomnav><li class=previous><a href=/post/next-edit-time/><span>&lt;&lt;&nbsp;</span>Next 主題修改更新時間的顯示規則</a></li><li class=next><a href=/post/anagrams/>Anagrams<span>&nbsp;>></span></a></li></ul></article></div><footer><div class=social-icons></div><div class=container><p class="credits copyright"><a href=https://anemology.cc/about>anemology</a>
&nbsp;&copy;
2022
&nbsp;/&nbsp;
<a href=https://anemology.cc/>翱翔在空中</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by">Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>